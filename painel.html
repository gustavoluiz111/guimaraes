<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel - Guimarães Equipamentos</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
body { margin:0; font-family: Arial,sans-serif; background:#f5f5f5; color:#333; transition:0.4s; }
body.dark { background:#1a1a1a; color:#f5f5f5; }

.menu-btn { position:fixed; top:15px; left:15px; width:35px; height:30px; cursor:pointer; z-index:1001; display:flex; flex-direction:column; justify-content:space-between; }
.menu-btn div { width:100%; height:5px; background-color:#ffcc00; transition:0.4s; }
.menu-btn.open div:nth-child(1){ transform: rotate(45deg) translate(6px,6px);}
.menu-btn.open div:nth-child(2){ opacity:0;}
.menu-btn.open div:nth-child(3){ transform: rotate(-45deg) translate(6px,-6px); }

.side-menu { position:fixed; left:-250px; top:0; width:250px; height:100%; background:#333; color:#ffcc00; padding-top:60px; transition:0.4s; z-index:1000; }
.side-menu a{ display:block; color:#ffcc00; padding:15px 20px; text-decoration:none; font-weight:bold;}
.side-menu a:hover{ background:#ffcc00; color:#333;}

.main{ padding:20px; margin-left:0; transition:0.4s;}
h1{ margin-top:0;}
.card-container{ display:flex; flex-wrap:wrap; gap:20px;}
.card{ width:180px; padding:15px; border-radius:10px; background:#fff; text-align:center; box-shadow:0 3px 6px rgba(0,0,0,0.2); transition:0.3s; cursor:pointer; }
.card.dark{ background:#333; color:#ffcc00;}
.status{ font-weight:bold; padding:5px; border-radius:5px; color:#fff; margin-top:5px; }
.disponivel{ background:green;}
.uso{ background:orange;}
.manutencao{ background:red;}

.switch{ font-size:17px; position:fixed; top:15px; right:15px; display:inline-block; width:4em; height:2.2em; border-radius:30px; box-shadow:0 0 10px rgba(0,0,0,0.1);}
.switch input{opacity:0; width:0; height:0;}
.slider{position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0; background:#2a2a2a; transition:0.4s; border-radius:30px; overflow:hidden;}
.slider:before{position:absolute; content:""; height:1.2em; width:1.2em; border-radius:20px; left:0.5em; bottom:0.5em; transition:0.4s; box-shadow:inset 8px -4px 0 #fff;}
.switch input:checked + .slider{ background:#00a6ff;}
.switch input:checked + .slider:before{ transform:translateX(1.8em); box-shadow: inset 15px -4px 0px 15px #ffcf48; }

#map{ height:300px; width:100%; margin-top:10px; border-radius:10px; }
#detalhesBetoneira{ margin-top:20px; padding:15px; border-radius:10px; background:#fff; box-shadow:0 3px 6px rgba(0,0,0,0.2);}
#detalhesBetoneira.dark{ background:#333; color:#ffcc00;}
#detalhesBetoneira img{ width:100px; margin-bottom:10px;}
#checklist div{ margin:5px 0; padding:5px; border:1px solid #ccc; border-radius:5px; cursor:pointer;}
#checklist div.selecionado{ background:#c5e5e4; border-color:#1f387e;}
</style>
</head>
<body>

<!-- Botão Hamburguer -->
<div class="menu-btn" onclick="toggleMenu()"><div></div><div></div><div></div></div>

<!-- Botão Tema -->
<label class="switch">
  <input id="checkbox" type="checkbox">
  <span class="slider"></span>
</label>

<!-- Menu Lateral -->
<div class="side-menu" id="sideMenu">
  <a href="#" onclick="showSection('monitoramento')">Monitoramento</a>
  <a href="#" onclick="showSection('chat')">Chat</a>
  <a href="#" onclick="showSection('contratos')">Contratos</a>
  <a href="#" onclick="showSection('relatorios')">Relatórios</a>
  <a href="index.html">Sair</a>
</div>

<!-- Conteúdo Principal -->
<div class="main" id="mainContent">
  <div id="monitoramento">
    <h1>Monitoramento das Betoneiras</h1>
    <div class="card-container" id="betoneiras"></div>
    <div id="detalhesBetoneira" style="display:none;">
      <h3 id="nomeBetoneira"></h3>
      <img id="imgBetoneira" src="" alt="Betoneira">
      <div id="statusDetalhe"></div>
      <div id="checklist"></div>
      <input type="file" id="uploadFoto"><br><br>
      <button onclick="finalizarAtualizacao()">Finalizar Atualização</button>
      <div id="map"></div>
    </div>
  </div>

  <div id="chat" style="display:none;">
    <h1>Chat</h1>
    <div id="chatBox" style="border:1px solid #ccc; height:200px; overflow-y:auto; padding:10px; background:#fff;"></div>
    <input type="text" id="mensagem" placeholder="Digite sua mensagem..." style="width:80%;">
    <button onclick="enviarMensagem()">Enviar</button>
  </div>

  <div id="contratos" style="display:none;">
    <h1>Contratos Digitais</h1>
    <textarea style="width:100%;height:120px;">Eu, LOCATÁRIO, declaro que recebi o equipamento em bom estado...</textarea>
    <br><button onclick="alert('Assinatura registrada!')">Assinar Digitalmente</button>
  </div>

  <div id="relatorios" style="display:none;">
    <h1>Relatórios (Admin)</h1>
    <table border="1" style="width:100%; border-collapse:collapse;">
      <thead><tr><th>Betoneira</th><th>Uso (dias)</th><th>Danos</th><th>Custo</th></tr></thead>
      <tbody id="relatorioBody"></tbody>
    </table>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const urlParams = new URLSearchParams(window.location.search);
const tipoUsuario = urlParams.get('tipo') || 'subordinado';

// Esconder menus conforme tipo
if(tipoUsuario==='subordinado'){ document.querySelector('a[href="#relatorios"]').style.display='none'; }

const sideMenu = document.getElementById("sideMenu");
const main = document.getElementById("mainContent");
let open = false;
function toggleMenu(){ open=!open; sideMenu.style.left=open?"0":"-250px"; main.style.marginLeft=open?"250px":"0"; document.querySelector('.menu-btn').classList.toggle('open', open); }

function showSection(sec){ ['monitoramento','chat','contratos','relatorios'].forEach(s=>document.getElementById(s).style.display='none'); document.getElementById(sec).style.display='block'; }

// Betoneiras fictícias
const betoneiras = [
  {id:'01', status:'Disponível', cliente:'Cliente A', local:'Rua 1', lat:-8.0, lng:-34.9},
  {id:'02', status:'Em Uso', cliente:'Cliente B', local:'Rua 2', lat:-8.02, lng:-34.91},
  {id:'03', status:'Em Manutenção', cliente:'Cliente C', local:'Rua 3', lat:-8.01, lng:-34.92}
];

const checklistItems = ['Pneu furado','Trinca no tambor','Motor falhando','Fiação solta'];
const betoneirasDiv = document.getElementById('betoneiras');

betoneiras.forEach(b=>{
  const card=document.createElement('div'); card.className='card';
  let statusClass = b.status==='Disponível'?'disponivel':b.status==='Em Uso'?'uso':'manutencao';
  card.innerHTML=`<h3>Betoneira ${b.id}</h3><div class="status ${statusClass}">${b.status}</div>`;
  card.onclick=()=>abrirDetalhe(b);
  betoneirasDiv.appendChild(card);
});

function abrirDetalhe(b){
  document.getElementById('detalhesBetoneira').style.display='block';
  document.getElementById('nomeBetoneira').innerText = 'Betoneira '+b.id;
  document.getElementById('imgBetoneira').src='https://raw.githubusercontent.com/gustavoluiz111/guimaraes/main/Aluguel%20De%20Betoneira%20Empresa%20De%20Loca%C3%A7%C3%A3o%20De%20Equipamentos%20Criativo%20Laranja%20Pr_20250917_232950_0000.png';
  document.getElementById('statusDetalhe').innerHTML = `<b>Status:</b> ${b.status} <br><b>Cliente:</b> ${b.cliente} <br><b>Local:</b> ${b.local}`;

  // Checklist
  const checklistDiv = document.getElementById('checklist');
  checklistDiv.innerHTML='';
  checklistItems.forEach(item=>{
    const d=document.createElement('div'); d.innerText=item; d.onclick=()=>d.classList.toggle('selecionado'); checklistDiv.appendChild(d);
  });

  // Map
  const mapDiv = document.getElementById('map');
  mapDiv.innerHTML='';
  const map = L.map('map').setView([b.lat,b.lng],14);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {attribution:'&copy; OSM'}).addTo(map);
  L.marker([b.lat,b.lng]).addTo(map).bindPopup('Betoneira '+b.id);
}

function finalizarAtualizacao(){
  const selecionados=[...document.querySelectorAll('#checklist .selecionado')].map(d=>d.innerText);
  alert('Atualização concluída!\nItens selecionados: '+(selecionados.length?selecionados.join(', '):'Nenhum'));
}

// Chat
const chatBox = document.getElementById('chatBox');
function enviarMensagem(){
  const msg = document.getElementById('mensagem').value; if(msg.trim()==='') return;
  const p=document.createElement('p'); p.innerHTML='<b>Você:</b> '+msg;
  chatBox.appendChild(p); document.getElementById('mensagem').value=''; chatBox.scrollTop=chatBox.scrollHeight;
}

// Relatórios fictícios
if(tipoUsuario==='admin'){
  const relBody = document.getElementById('relatorioBody');
  [{id:'01',uso:10,danos:2,custo:'R$ 120'},{id:'02',uso:7,danos:0,custo:'R$ 0'},{id:'03',uso:15,danos:3,custo:'R$ 450'}].forEach(r=>{
    const tr=document.createElement('tr'); tr.innerHTML=`<td>${r.id}</td><td>${r.uso}</td><td>${r.danos}</td><td>${r.custo}</td>`; relBody.appendChild(tr);
  });
}

// Tema
const checkbox=document.getElementById('checkbox');
checkbox.addEventListener('change',()=>{ document.body.classList.toggle('dark', checkbox.checked); document.querySelectorAll('.card').forEach(c=>c.classList.toggle('dark', checkbox.checked)); });
</script>
</body>
</html>
